!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).fuzzball=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t={exports:{}},r=Math.floor,o=Math.max,n=Math.min,_calculateRatio=function(e,t){return t?2*e/t:1},_arrayCmp=function(e,t){var r,o,i,s,a,c;for(a=[e.length,t.length],r=s=0,c=n(o=a[0],i=a[1]);0<=c?s<c:s>c;r=0<=c?++s:--s){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return o-i},_has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i=function(){function SequenceMatcher(e,t,r,o){this.isjunk=e,null==t&&(t=""),null==r&&(r=""),this.autojunk=null==o||o,this.a=this.b=null,this.setSeqs(t,r)}return SequenceMatcher.prototype.setSeqs=function(e,t){return this.setSeq1(e),this.setSeq2(t)},SequenceMatcher.prototype.setSeq1=function(e){if(e!==this.a)return this.a=e,this.matchingBlocks=this.opcodes=null},SequenceMatcher.prototype.setSeq2=function(e){if(e!==this.b)return this.b=e,this.matchingBlocks=this.opcodes=null,this.fullbcount=null,this._chainB()},SequenceMatcher.prototype._chainB=function(){var e,t,o,n,i,s,a,c,l,u,f,p,h,d;for(e=this.b,this.b2j=t={},n=u=0,p=e.length;u<p;n=++u)o=e[n],(_has(t,o)?t[o]:t[o]=[]).push(n);if(s={},i=this.isjunk)for(f=0,h=(d=Object.keys(t)).length;f<h;f++)i(o=d[f])&&(s[o]=!0,delete t[o]);if(l={},a=e.length,this.autojunk&&a>=200)for(o in c=r(a/100)+1,t)t[o].length>c&&(l[o]=!0,delete t[o]);return this.isbjunk=function(e){return _has(s,e)},this.isbpopular=function(e){return _has(l,e)}},SequenceMatcher.prototype.findLongestMatch=function(e,t,r,o){var n,i,s,a,c,l,u,f,p,h,d,g,_,m,y,v,k,b,w,z,C;for(n=(v=[this.a,this.b,this.b2j,this.isbjunk])[0],i=v[1],s=v[2],f=v[3],a=(k=[e,r,0])[0],c=k[1],l=k[2],h={},u=_=e;e<=t?_<t:_>t;u=e<=t?++_:--_){for(g={},m=0,y=(b=_has(s,n[u])?s[n[u]]:[]).length;m<y;m++)if(!((p=b[m])<r)){if(p>=o)break;(d=g[p]=(h[p-1]||0)+1)>l&&(a=(w=[u-d+1,p-d+1,d])[0],c=w[1],l=w[2])}h=g}for(;a>e&&c>r&&!f(i[c-1])&&n[a-1]===i[c-1];)a=(z=[a-1,c-1,l+1])[0],c=z[1],l=z[2];for(;a+l<t&&c+l<o&&!f(i[c+l])&&n[a+l]===i[c+l];)l++;for(;a>e&&c>r&&f(i[c-1])&&n[a-1]===i[c-1];)a=(C=[a-1,c-1,l+1])[0],c=C[1],l=C[2];for(;a+l<t&&c+l<o&&f(i[c+l])&&n[a+l]===i[c+l];)l++;return[a,c,l]},SequenceMatcher.prototype.getMatchingBlocks=function(){var e,t,r,o,n,i,s,a,c,l,u,f,p,h,d,g,_,m,y,v,k,b,w,z,C,S;if(this.matchingBlocks)return this.matchingBlocks;for(m=[[0,h=(b=[this.a.length,this.b.length])[0],0,d=b[1]]],g=[];m.length;)t=(w=m.pop())[0],e=w[1],o=w[2],r=w[3],n=(z=y=this.findLongestMatch(t,e,o,r))[0],a=z[1],(u=z[2])&&(g.push(y),t<n&&o<a&&m.push([t,n,o,a]),n+u<e&&a+u<r&&m.push([n+u,e,a+u,r]));for(g.sort(_arrayCmp),i=c=f=0,_=[],v=0,k=g.length;v<k;v++)s=(C=g[v])[0],l=C[1],p=C[2],i+f===s&&c+f===l?f+=p:(f&&_.push([i,c,f]),i=(S=[s,l,p])[0],c=S[1],f=S[2]);return f&&_.push([i,c,f]),_.push([h,d,0]),this.matchingBlocks=_},SequenceMatcher.prototype.getOpcodes=function(){var e,t,r,o,n,i,s,a,c,l,u,f;if(this.opcodes)return this.opcodes;for(o=n=0,this.opcodes=t=[],a=0,c=(l=this.getMatchingBlocks()).length;a<c;a++)e=(u=l[a])[0],r=u[1],i=u[2],s="",o<e&&n<r?s="replace":o<e?s="delete":n<r&&(s="insert"),s&&t.push([s,o,e,n,r]),o=(f=[e+i,r+i])[0],n=f[1],i&&t.push(["equal",e,o,r,n]);return t},SequenceMatcher.prototype.getGroupedOpcodes=function(e){var t,r,i,s,a,c,l,u,f,p,h,d,g,_,m;for(null==e&&(e=3),(t=this.getOpcodes()).length||(t=[["equal",0,1,0,1]]),"equal"===t[0][0]&&(f=(d=t[0])[0],s=d[1],a=d[2],c=d[3],l=d[4],t[0]=[f,o(s,a-e),a,o(c,l-e),l]),"equal"===t[t.length-1][0]&&(f=(g=t[t.length-1])[0],s=g[1],a=g[2],c=g[3],l=g[4],t[t.length-1]=[f,s,n(a,s+e),c,n(l,c+e)]),u=e+e,i=[],r=[],p=0,h=t.length;p<h;p++)f=(_=t[p])[0],s=_[1],a=_[2],c=_[3],l=_[4],"equal"===f&&a-s>u&&(r.push([f,s,n(a,s+e),c,n(l,c+e)]),i.push(r),r=[],s=(m=[o(s,a-e),o(c,l-e)])[0],c=m[1]),r.push([f,s,a,c,l]);return!r.length||1===r.length&&"equal"===r[0][0]||i.push(r),i},SequenceMatcher.prototype.ratio=function(){var e,t,r,o;for(e=0,t=0,r=(o=this.getMatchingBlocks()).length;t<r;t++)e+=o[t][2];return _calculateRatio(e,this.a.length+this.b.length)},SequenceMatcher.prototype.quickRatio=function(){var e,t,r,o,n,i,s,a,c,l,u;if(!this.fullbcount)for(this.fullbcount=r={},i=0,a=(l=this.b).length;i<a;i++)r[t=l[i]]=(r[t]||0)+1;for(r=this.fullbcount,e={},o=0,s=0,c=(u=this.a).length;s<c;s++)t=u[s],n=_has(e,t)?e[t]:r[t]||0,e[t]=n-1,n>0&&o++;return _calculateRatio(o,this.a.length+this.b.length)},SequenceMatcher.prototype.realQuickRatio=function(){var e,t,r;return r=[this.a.length,this.b.length],_calculateRatio(n(e=r[0],t=r[1]),e+t)},SequenceMatcher}(),s={exports:{}};!function(t,r){(function(){var e,r,o,n,i,s,a,c,l,u,f,p,h,d,g;o=Math.floor,u=Math.min,r=function(e,t){return e<t?-1:e>t?1:0},l=function(e,t,n,i,s){var a;if(null==n&&(n=0),null==s&&(s=r),n<0)throw new Error("lo must be non-negative");for(null==i&&(i=e.length);n<i;)s(t,e[a=o((n+i)/2)])<0?i=a:n=a+1;return[].splice.apply(e,[n,n-n].concat(t)),t},s=function(e,t,o){return null==o&&(o=r),e.push(t),d(e,0,e.length-1,o)},i=function(e,t){var o,n;return null==t&&(t=r),o=e.pop(),e.length?(n=e[0],e[0]=o,g(e,0,t)):n=o,n},c=function(e,t,o){var n;return null==o&&(o=r),n=e[0],e[0]=t,g(e,0,o),n},a=function(e,t,o){var n;return null==o&&(o=r),e.length&&o(e[0],t)<0&&(t=(n=[e[0],t])[0],e[0]=n[1],g(e,0,o)),t},n=function(e,t){var n,i,s,a,c,l;for(null==t&&(t=r),c=[],i=0,s=(a=function(){l=[];for(var t=0,r=o(e.length/2);0<=r?t<r:t>r;0<=r?t++:t--)l.push(t);return l}.apply(this).reverse()).length;i<s;i++)n=a[i],c.push(g(e,n,t));return c},h=function(e,t,o){var n;if(null==o&&(o=r),-1!==(n=e.indexOf(t)))return d(e,0,n,o),g(e,n,o)},f=function(e,t,o){var i,s,c,l,u;if(null==o&&(o=r),!(s=e.slice(0,t)).length)return s;for(n(s,o),c=0,l=(u=e.slice(t)).length;c<l;c++)i=u[c],a(s,i,o);return s.sort(o).reverse()},p=function(e,t,o){var s,a,c,f,p,h,d,g,_;if(null==o&&(o=r),10*t<=e.length){if(!(c=e.slice(0,t).sort(o)).length)return c;for(a=c[c.length-1],f=0,h=(d=e.slice(t)).length;f<h;f++)o(s=d[f],a)<0&&(l(c,s,0,null,o),c.pop(),a=c[c.length-1]);return c}for(n(e,o),_=[],p=0,g=u(t,e.length);0<=g?p<g:p>g;0<=g?++p:--p)_.push(i(e,o));return _},d=function(e,t,o,n){var i,s,a;for(null==n&&(n=r),i=e[o];o>t&&n(i,s=e[a=o-1>>1])<0;)e[o]=s,o=a;return e[o]=i},g=function(e,t,o){var n,i,s,a,c;for(null==o&&(o=r),i=e.length,c=t,s=e[t],n=2*t+1;n<i;)(a=n+1)<i&&!(o(e[n],e[a])<0)&&(n=a),e[t]=e[n],n=2*(t=n)+1;return e[t]=s,d(e,c,t,o)},e=function(){function Heap(e){this.cmp=null!=e?e:r,this.nodes=[]}return Heap.push=s,Heap.pop=i,Heap.replace=c,Heap.pushpop=a,Heap.heapify=n,Heap.updateItem=h,Heap.nlargest=f,Heap.nsmallest=p,Heap.prototype.push=function(e){return s(this.nodes,e,this.cmp)},Heap.prototype.pop=function(){return i(this.nodes,this.cmp)},Heap.prototype.peek=function(){return this.nodes[0]},Heap.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},Heap.prototype.replace=function(e){return c(this.nodes,e,this.cmp)},Heap.prototype.pushpop=function(e){return a(this.nodes,e,this.cmp)},Heap.prototype.heapify=function(){return n(this.nodes,this.cmp)},Heap.prototype.updateItem=function(e){return h(this.nodes,e,this.cmp)},Heap.prototype.clear=function(){return this.nodes=[]},Heap.prototype.empty=function(){return 0===this.nodes.length},Heap.prototype.size=function(){return this.nodes.length},Heap.prototype.clone=function(){var e;return(e=new Heap).nodes=this.nodes.slice(0),e},Heap.prototype.toArray=function(){return this.nodes.slice(0)},Heap.prototype.insert=Heap.prototype.push,Heap.prototype.top=Heap.prototype.peek,Heap.prototype.front=Heap.prototype.peek,Heap.prototype.has=Heap.prototype.contains,Heap.prototype.copy=Heap.prototype.clone,Heap}(),t.exports=e}).call(e)}(s);var a=s.exports;var c,l={_intersect:function _intersect(e,t){if(!e||!t||0===e.length||0===t.length)return[];if(e.length<100&&t.length<100)return e.filter((e=>t.includes(e)));const r=new Set(t);return e.filter((e=>r.has(e)))},_intersectWith:function _intersectWith(e,t,r){return e&&t&&0!==e.length&&0!==t.length?e.filter((e=>t.some((t=>r(e,t))))):[]},_difference:function _difference(e,t){if(!e)return[];if(!t||0===t.length)return e.slice();if(e.length<100&&t.length<100)return e.filter((e=>!t.includes(e)));const r=new Set(t);return e.filter((e=>!r.has(e)))},_differenceWith:function _differenceWith(e,t,r){return e?t&&0!==t.length?e.filter((e=>!t.some((t=>r(e,t))))):e.slice():[]},_uniq:function _uniq(e){return e&&0!==e.length?1===e.length?e.slice():[...new Set(e)]:[]},_uniqWith:function _uniqWith(e,t){return e&&0!==e.length?1===e.length?e.slice():e.filter(((e,r,o)=>r===o.findIndex((r=>t(e,r))))):[]},_partialRight:function _partialRight(e){const t=Array.prototype.slice.call(arguments,1);return function(){const r=Array.prototype.slice.call(arguments);return e.apply(this,r.concat(t))}},_forEach:function _forEach(e,t){if(e)if(Array.isArray(e))for(let r=0;r<e.length;r++)t(e[r],r);else{const r=Object.keys(e);for(let o=0;o<r.length;o++)t(e[r[o]],r[o])}},_keys:function _keys(e){return Object.keys(e)},_isArray:function _isArray(e){return Array.isArray(e)},_toArray:function _toArray(e){return e?Array.isArray(e)?e.slice():"string"==typeof e?e.split(""):Object.values(e):[]},_orderBy:function _orderBy(e,t,r){if(!e||0===e.length)return[];const o=e.slice();if("function"==typeof t){const e=t;return"desc"===r?o.sort(((t,r)=>{const o=e(t),n=e(r);return"number"==typeof o&&"number"==typeof n?n-o:n<o?-1:n>o?1:0})):o.sort(((t,r)=>{const o=e(t),n=e(r);return"number"==typeof o&&"number"==typeof n?o-n:o<n?-1:o>n?1:0}))}return"desc"===r?o.sort(((e,r)=>{const o=t(e),n=t(r);return"number"==typeof o&&"number"==typeof n?n-o:String(n).localeCompare(String(o))})):o.sort(((e,r)=>{const o=t(e),n=t(r);return"number"==typeof o&&"number"==typeof n?o-n:String(o).localeCompare(String(n))}))}};try{c="undefined"!=typeof Intl&&void 0!==Intl.Collator?Intl.Collator("generic",{sensitivity:"base"}):null}catch(e){void 0!==typeof console&&console.warn("Collator could not be initialized and wouldn't be used")}var u,f=function leven(e,t,r){var o=[],n=[],i=r&&c&&r.useCollator,s=1;if(r&&r.subcost&&"number"==typeof r.subcost&&(s=r.subcost),e===t)return 0;var a,l,u,f,p=Array.from(e),h=Array.from(t),d=p.length,g=h.length;if(0===d)return g;if(0===g)return d;for(var _=0,m=0;_<d;)n[_]=p[_].codePointAt(0),o[_]=++_;if(i)for(;m<g;)for(a=h[m].codePointAt(0),u=m++,l=m,_=0;_<d;_++)f=0===c.compare(String.fromCodePoint(a),String.fromCodePoint(n[_]))?u:u+s,u=o[_],l=o[_]=u>l?f>l?l+1:f:f>u?u+1:f;else for(;m<g;)for(a=h[m].codePointAt(0),u=m++,l=m,_=0;_<d;_++)f=a===n[_]?u:u+s,u=o[_],l=o[_]=u>l?f>l?l+1:f:f>u?u+1:f;return l};try{u="undefined"!=typeof Intl&&void 0!==Intl.Collator?Intl.Collator("generic",{sensitivity:"base"}):null}catch(e){void 0!==typeof console&&console.warn("Collator could not be initialized and wouldn't be used")}var p,h=function leven(e,t,r,o){var n=[],i=[],s=r&&u&&r.useCollator,a=1;if(r&&r.subcost&&"number"==typeof r.subcost&&(a=r.subcost),e===t)return 0;var c=e.length,l=t.length;if(0===c)return l;if(0===l)return c;if(r&&r.wildcards&&"string"==typeof r.wildcards&&r.wildcards.length>0){var f,p,h,d,g,_;if(!1===r.full_process&&!0!==r.processed){p=(f=r.wildcards[0]).charCodeAt(0);var m="["+function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(r.wildcards)+"]";if((e=e.replace(new RegExp(m,"g"),f))===(t=t.replace(new RegExp(m,"g"),f)))return 0}else p=(f=r.wildcards[0].toLowerCase()).charCodeAt(0);for(var y=0,v=0;y<c;)i[y]=e.charCodeAt(y),n[y]=++y;if(s)for(;v<l;)for(h=t.charCodeAt(v),g=v++,d=v,y=0;y<c;y++)_=0===u.compare(String.fromCharCode(h),String.fromCharCode(i[y]))||h===p||i[y]===p?g:g+a,g=n[y],d=n[y]=g>d?_>d?d+1:_:_>g?g+1:_;else for(;v<l;)for(h=t.charCodeAt(v),g=v++,d=v,y=0;y<c;y++)_=h===i[y]||h===p||i[y]===p?g:g+a,g=n[y],d=n[y]=g>d?_>d?d+1:_:_>g?g+1:_;return d}return o(e,t,r)};try{p="undefined"!=typeof Intl&&void 0!==Intl.Collator?Intl.Collator("generic",{sensitivity:"base"}):null}catch(e){void 0!==typeof console&&console.warn("Collator could not be initialized and wouldn't be used")}var d=function leven(e,t,r){var o=[],n=[],i=r&&p&&r.useCollator,s=1;if(r&&r.subcost&&"number"==typeof r.subcost&&(s=r.subcost),e===t)return 0;var a,c,l,u,f=e.length,h=t.length;if(0===f)return h;if(0===h)return f;for(var d=0,g=0;d<f;)n[d]=e.charCodeAt(d),o[d]=++d;if(i)for(;g<h;)for(a=t.charCodeAt(g),l=g++,c=g,d=0;d<f;d++)u=0===p.compare(String.fromCharCode(a),String.fromCharCode(n[d]))?l:l+s,l=o[d],c=o[d]=l>c?u>c?c+1:u:u>l?l+1:u;else for(;g<h;)for(a=t.charCodeAt(g),l=g++,c=g,d=0;d<f;d++)u=a===n[d]?l:l+s,l=o[d],c=o[d]=l>c?u>c?c+1:u:u>l?l+1:u;return c};!function(e,t){if(!e.setImmediate){var r,o=1,n={},i=!1,s=e.document,a=Object.getPrototypeOf&&Object.getPrototypeOf(e);a=a&&a.setTimeout?a:e,"[object process]"==={}.toString.call(e.process)?function installNextTickImplementation(){r=function(e){process.nextTick((function(){runIfPresent(e)}))}}():!function canUsePostMessage(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?function installMessageChannelImplementation(){var e=new MessageChannel;e.port1.onmessage=function(e){runIfPresent(e.data)},r=function(t){e.port2.postMessage(t)}}():s&&"onreadystatechange"in s.createElement("script")?function installReadyStateChangeImplementation(){var e=s.documentElement;r=function(t){var r=s.createElement("script");r.onreadystatechange=function(){runIfPresent(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}():function installSetTimeoutImplementation(){r=function(e){setTimeout(runIfPresent,0,e)}}():function installPostMessageImplementation(){var t="setImmediate$"+Math.random()+"$",onGlobalMessage=function(r){r.source===e&&"string"==typeof r.data&&0===r.data.indexOf(t)&&runIfPresent(+r.data.slice(t.length))};e.addEventListener?e.addEventListener("message",onGlobalMessage,!1):e.attachEvent("onmessage",onGlobalMessage),r=function(r){e.postMessage(t+r,"*")}}(),a.setImmediate=function setImmediate(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var s={callback:e,args:t};return n[o]=s,r(o),o++},a.clearImmediate=clearImmediate}function clearImmediate(e){delete n[e]}function runIfPresent(e){if(i)setTimeout(runIfPresent,0,e);else{var t=n[e];if(t){i=!0;try{!function run(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(void 0,r)}}(t)}finally{clearImmediate(e),i=!1}}}}}("undefined"==typeof self?e:self);var g={exports:{}};return function(e){e.exports=function(t,r,o,n){return(e={}).dedupe=function dedupe(e,i){var s,a=t(i);if(!r(e)&&"object"!=typeof e)throw new Error("contains_dupes must be an array or object");if(0===Object.keys(e).length)return void 0!==typeof console&&console.warn("contains_dupes is empty"),[];a.limit&&(void 0!==typeof console&&console.warn("options.limit will be ignored in dedupe"),a.limit=0),a.cutoff&&"number"==typeof a.cutoff||(void 0!==typeof console&&console.warn("Using default cutoff of 70"),a.cutoff=70),a.scorer||(a.scorer=o,void 0!==typeof console&&console.log("Using default scorer 'ratio' for dedupe")),s=a.processor&&"function"==typeof a.processor?a.processor:function(e){return e};var c={};for(var l in e){var u=s(e[l]);if("string"!=typeof u&&u instanceof String==!1)throw new Error("Each processed item in dedupe must be a string.");var f=n(u,e,a);a.returnObjects?(1===f.length||(f=f.sort((function(e,t){var r=s(e.choice),o=s(t.choice),n=r.length,i=o.length;return n===i?r<o?-1:1:i-n}))),a.keepmap?c[s(f[0].choice)]={item:f[0].choice,key:f[0].key,matches:f}:c[s(f[0].choice)]={item:f[0].choice,key:f[0].key}):(1===f.length||(f=f.sort((function(e,t){var r=s(e[0]),o=s(t[0]),n=r.length,i=o.length;return n===i?r<o?-1:1:i-n}))),a.keepmap?c[s(f[0][0])]=[f[0][0],f[0][2],f]:c[s(f[0][0])]=[f[0][0],f[0][2]])}var p=[];for(var h in c)p.push(c[h]);return p},e}}(g),function(){var e=i,r=a,o=l._intersect,n=l._intersectWith,s=l._difference,c=l._differenceWith,u=l._partialRight,p=l._forEach,_=l._keys,m=l._isArray,y=l._orderBy,v=f,k=h,b=d,w=function(e,t,r){var o={},n=h,i=d;function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function validate(e){return("string"==typeof e||e instanceof String)&&e.length>0}o.validate=validate,o.process_and_sort=function process_and_sort(e){return validate(e)?e.match(/\S+/g).sort().join(" ").trim():""},o.tokenize=function unique_tokens(o,s){if(s&&s.wildcards&&t&&r){var a=r(n,s,i);return t(o.match(/\S+/g),(function(e,t){return 0===a(e,t)}))}return e(o.match(/\S+/g))};const s=/[^\p{L}\p{N}]/gu;return o.full_process=function full_process(e,t){if(!(e instanceof String)&&"string"!=typeof e)return"";var r;if(t&&"object"==typeof t&&t.wildcards&&"string"==typeof t.wildcards&&t.wildcards.length>0){var o=t.wildcards.toLowerCase();if(e=e.toLowerCase(),t.force_ascii){var n="[^\0 -|"+escapeRegExp(o)+"]";e=e.replace(new RegExp(n,"g"),"");var i="["+escapeRegExp(o)+"]",a=o[0];e=e.replace(new RegExp(i,"g"),a);var c="[^A-Za-z0-9"+escapeRegExp(o)+"]";r=(e=(e=e.replace(new RegExp(c,"g")," ")).replace(/_/g," ")).trim()}else{var l="[^\\p{L}\\p{N}|"+escapeRegExp(o)+"]";e=e.replace(new RegExp(l,"gu")," "),i="["+escapeRegExp(o)+"]",a=o[0],r=(e=e.replace(new RegExp(i,"g"),a)).trim()}}else t&&(t.force_ascii||!0===t)&&(r=(e=e.replace(/[^\x00-\x7F]/g,"")).replace(/\W|_/g," ").toLowerCase().trim()),r=e.replace(s," ").toLowerCase().trim();return t&&t.collapseWhitespace&&(r=r.replace(/\s+/g," ")),r},o.clone_and_set_option_defaults=function(e){if(e&&e.isAClone)return e;var t={isAClone:!0};if(e){var r,o=Object.keys(e);for(r=0;r<o.length;r++)t[o[r]]=e[o[r]]}return!1!==t.full_process&&(t.full_process=!0),!0!==t.force_ascii&&(t.force_ascii=!1),!1!==t.normalize&&!0===t.astral&&(t.normalize=!0),!1!==t.collapseWhitespace&&(t.collapseWhitespace=!0),t},o.isCustomFunc=function(e){return"function"!=typeof e||"token_set_ratio"!==e.name&&"partial_token_set_ratio"!==e.name&&"token_sort_ratio"!==e.name&&"partial_token_sort_ratio"!==e.name&&"QRatio"!==e.name&&"WRatio"!==e.name&&"distance"!==e.name&&"partial_ratio"!==e.name},o}(l._uniq,l._uniqWith,u),z=w.validate,C=w.process_and_sort,S=w.tokenize,j=w.full_process,x=w.clone_and_set_option_defaults,M=w.isCustomFunc,O=g.exports(x,m,QRatio,extract).dedupe;function QRatio(e,t,r){var o=x(r);return e=o.normalize?e.normalize():e,t=o.normalize?t.normalize():t,e=o.full_process?j(e,o):e,t=o.full_process?j(t,o):t,z(e)&&z(t)?_ratio(e,t,o):0}function token_set_ratio(e,t,r){var o=x(r);return e=o.normalize?e.normalize():e,t=o.normalize?t.normalize():t,e=o.full_process?j(e,o):e,t=o.full_process?j(t,o):t,z(e)&&z(t)?_token_set(e,t,o):0}function partial_token_set_ratio(e,t,r){var o=x(r);return e=o.normalize?e.normalize():e,t=o.normalize?t.normalize():t,e=o.full_process?j(e,o):e,t=o.full_process?j(t,o):t,z(e)&&z(t)?(o.partial=!0,_token_set(e,t,o)):0}function token_sort_ratio(e,t,r){var o=x(r);return e=o.normalize?e.normalize():e,t=o.normalize?t.normalize():t,e=o.full_process?j(e,o):e,t=o.full_process?j(t,o):t,z(e)&&z(t)?(o.proc_sorted||(e=C(e),t=C(t)),_ratio(e,t,o)):0}function partial_token_sort_ratio(e,t,r){var o=x(r);return e=o.normalize?e.normalize():e,t=o.normalize?t.normalize():t,e=o.full_process?j(e,o):e,t=o.full_process?j(t,o):t,z(e)&&z(t)?(o.partial=!0,o.proc_sorted||(e=C(e),t=C(t)),_partial_ratio(e,t,o)):0}function extract(e,t,o){var n,i=x(o);if(m(t))n=t.length;else{if(!(t instanceof Object))throw new Error("Invalid choices");n=_(t).length}if(!t||0===n)return void 0!==typeof console&&console.warn("No choices"),[];if(i.processor&&"function"!=typeof i.processor)throw new Error("Invalid Processor");if(i.processor||(i.processor=function(e){return e}),i.scorer&&"function"!=typeof i.scorer)throw new Error("Invalid Scorer");i.scorer||(i.scorer=QRatio);var s=M(i.scorer);i.cutoff&&"number"==typeof i.cutoff||(i.cutoff=-1);var pre_processor=function(e,t){return e};i.full_process&&(pre_processor=j,s||(i.processed=!0));var a=!1;s||(i.astral&&i.normalize&&(i.normalize=!1,String.prototype.normalize?(a=!0,e=e.normalize()):void 0!==typeof console&&console.warn("Normalization not supported in your environment")),e=pre_processor(e,i),i.full_process=!1,0===e.length&&void 0!==typeof console&&console.warn("Processed query is empty string"));var c,l,u,f,h=[],d=!1,g=!1,y=!1;if("token_sort_ratio"===i.scorer.name||"partial_token_sort_ratio"===i.scorer.name){var v=C(e);g=!0}else if("token_set_ratio"===i.scorer.name||"partial_token_set_ratio"===i.scorer.name){var k=S(e,i);y=!0}return i.returnObjects?(u=function(e,t){return e.score-t.score},f=function(e,t){return t.score-e.score}):(u=function(e,t){return e[1]-t[1]},f=function(e,t){return t[1]-e[1]}),p(t,(function(t,r){i.tokens=void 0,i.proc_sorted=!1,g?(i.proc_sorted=!0,t&&t.proc_sorted?l=t.proc_sorted:(l=pre_processor(a?i.processor(t).normalize():i.processor(t),i),l=C(l)),c=i.scorer(v,l,i)):y?(l="x",t&&t.tokens?(i.tokens=[k,t.tokens],i.trySimple&&(l=pre_processor(i.processor(t),i))):(l=pre_processor(a?i.processor(t).normalize():i.processor(t),i),i.tokens=[k,S(l,i)]),c=i.scorer(e,l,i)):s?(l=i.processor(t),c=i.scorer(e,l,i)):("string"==typeof(l=pre_processor(a?i.processor(t).normalize():i.processor(t),i))&&0!==l.length||(d=!0),c=i.scorer(e,l,i)),c>i.cutoff&&(i.returnObjects?h.push({choice:t,score:c,key:r}):h.push([t,c,r]))})),d&&void 0!==typeof console&&console.log("One or more choices were empty. (post-processing if applied)"),i.limit&&"number"==typeof i.limit&&i.limit>0&&i.limit<n&&!i.unsorted?h=r.nlargest(h,i.limit,u):i.unsorted||(h=h.sort(f)),h}function extractAsync(e,t,o,n){var i,s,a=x(o);"object"==typeof o.abortController&&(i=o.abortController),"object"==typeof o.cancelToken&&(s=o.cancelToken);var c=256;"number"==typeof a.asyncLoopOffset&&(c=a.asyncLoopOffset<1?1:a.asyncLoopOffset);var l,u=!1;if(t&&t.length&&m(t))l=t.length,u=!0;else{if(!(t instanceof Object))return void n(new Error("Invalid choices"));l=Object.keys(t).length}if(!t||0===l)return void 0!==typeof console&&console.warn("No choices"),void n(null,[]);if(a.processor&&"function"!=typeof a.processor)n(new Error("Invalid Processor"));else if(a.processor||(a.processor=function(e){return e}),a.scorer&&"function"!=typeof a.scorer)n(new Error("Invalid Scorer"));else{a.scorer||(a.scorer=QRatio);var f=M(a.scorer);a.cutoff&&"number"==typeof a.cutoff||(a.cutoff=-1);var pre_processor=function(e,t){return e};a.full_process&&(pre_processor=j,f||(a.processed=!0));var p=!1;f||(a.astral&&a.normalize&&(a.normalize=!1,String.prototype.normalize?(p=!0,e=e.normalize()):void 0!==typeof console&&console.warn("Normalization not supported in your environment")),e=pre_processor(e,a),a.full_process=!1,0===e.length&&void 0!==typeof console&&console.warn("Processed query is empty string"));var h,d,g,_,y,v=[],k=!1,b=!1,w=!1;if("token_sort_ratio"===a.scorer.name||"partial_token_sort_ratio"===a.scorer.name){var z=C(e);b=!0}else if("token_set_ratio"===a.scorer.name||"partial_token_set_ratio"===a.scorer.name){var O=S(e,a);w=!0}a.returnObjects?(_=function(e,t){return e.score-t.score},y=function(e,t){return t.score-e.score}):(_=function(e,t){return e[1]-t[1]},y=function(e,t){return t[1]-e[1]});var I=Object.keys(t);u?searchLoop(0):searchLoop(I[0],0)}function searchLoop(o,m){(u||t.hasOwnProperty(o))&&(a.tokens=void 0,a.proc_sorted=!1,b?(a.proc_sorted=!0,t[o]&&t[o].proc_sorted?d=t[o].proc_sorted:(d=pre_processor(p?a.processor(t[o]).normalize():a.processor(t[o]),a),d=C(d)),g=a.scorer(z,d,a)):w?(d="x",t[o]&&t[o].tokens?(a.tokens=[O,t[o].tokens],a.trySimple&&(d=pre_processor(a.processor(t[o]),a))):(d=pre_processor(p?a.processor(t[o]).normalize():a.processor(t[o]),a),a.tokens=[O,S(d,a)]),g=a.scorer(e,d,a)):f?(d=a.processor(t[o]),g=a.scorer(e,d,a)):("string"==typeof(d=pre_processor(p?a.processor(t[o]).normalize():a.processor(t[o]),a))&&0!==d.length||(k=!0),g=a.scorer(e,d,a)),h=u?parseInt(o):o,g>a.cutoff&&(a.returnObjects?v.push({choice:t[o],score:g,key:h}):v.push([t[o],g,h]))),i&&!0===i.signal.aborted?n(new Error("aborted")):s&&!0===s.canceled?n(new Error("canceled")):u&&o<t.length-1?o%c==0?setImmediate((function(){searchLoop(o+1)})):searchLoop(o+1):m<I.length-1?m%c==0?setImmediate((function(){searchLoop(I[m+1],m+1)})):searchLoop(I[m+1],m+1):(k&&void 0!==typeof console&&console.log("One or more choices were empty. (post-processing if applied)"),a.limit&&"number"==typeof a.limit&&a.limit>0&&a.limit<l&&!a.unsorted?v=r.nlargest(v,a.limit,_):a.unsorted||(v=v.sort(y)),n(null,v))}}var I,q,A,E,H="%*SuperUniqueWildcardKey*%";function _getCharacterCounts(e,t){var r=e;if(t.astral)var o=Array.from(r);else o=r.split("");var n={};if(t.wildcards)for(var i=0;i<o.length;i++){var s=o[i];t.wildcards.indexOf(s)>-1?n[H]?n[H]+=1:n[H]=1:n[s]?n[s]+=1:n[s]=1}else for(i=0;i<o.length;i++){n[s=o[i]]?n[s]+=1:n[s]=1}return n}function _token_similarity_sort(e,t,r){for(var n=t,i=e.reduce((function(e,t){return e[t]=_getCharacterCounts(t,r),e}),{}),s=n.reduce((function(e,t){return e[t]=_getCharacterCounts(t,r),e}),{}),a=[],c=0;n.length&&c<e.length;){var l=y(n,(function(t){return r=i[e[c]],n=s[t],a=Object.keys(r),l=Object.keys(n),u=o(a,l).map((function(e){return r[e]*n[e]})).reduce((function(e,t){return e+t}),0),f=a.map((function(e){return Math.pow(r[e],2)})).reduce((function(e,t){return e+t}),0),p=l.map((function(e){return Math.pow(n[e],2)})).reduce((function(e,t){return e+t}),0),u/(Math.sqrt(f)*Math.sqrt(p));var r,n,a,l,u,f,p}),"desc")[0];a.push(l),c++,n=n.filter((function(e){return e!==l}))}return a.concat(n)}function _order_token_lists(e,t,r,o){var n=t,i=o;if(t.length>o.length)n=o,i=t;else if(t.length===o.length){if(e.length>r.length)n=o,i=t;else[e,r].sort()[0]===r&&(n=o,i=t)}return[n,i]}function _token_similarity_sort_ratio(e,t,r){if(r.tokens)o=r.tokens[0],n=r.tokens[1];else var o=S(e,r),n=S(t,r);var i=_order_token_lists(e,o.sort(),t,n.sort()),s=i[0];const a=_token_similarity_sort(s,i[1],r);return r.partial?_partial_ratio(s.join(" "),a.join(" "),r):_ratio(s.join(" "),a.join(" "),r)}function _token_set(e,t,r){if(r.tokens)i=r.tokens[0],a=r.tokens[1];else var i=S(e,r),a=S(t,r);if(r.wildcards)var l=u(k,r,b),wildCompare=function(e,t){return 0===l(e,t)},f=n(i,a,wildCompare),p=c(i,a,wildCompare),h=c(a,i,wildCompare);else f=o(i,a),p=s(i,a),h=s(a,i);var d=f.sort().join(" "),g=p.sort(),_=h.sort();if(r.sortBySimilarity)var m=_order_token_lists(e,g,t,_),y=m[0],v=m[1],w=y.join(" "),z=_token_similarity_sort(y,v,r).join(" ");else w=g.join(" "),z=_.join(" ");var C=d+" "+w,j=d+" "+z;d=d.trim(),C=C.trim(),j=j.trim();var x=_ratio;if(r.partial&&(x=_partial_ratio,d.length>0))return 100;var M=[x(d,C,r),x(d,j,r),x(C,j,r)];return r.trySimple&&M.push(x(e,t,r)),Math.max.apply(null,M)}function _ratio(t,r,o){if(!z(t))return 0;if(!z(r))return 0;if(o.ratio_alg&&"difflib"===o.ratio_alg){var n=new e(null,t,r).ratio();return Math.round(100*n)}var i,s;return void 0===o.subcost&&(o.subcost=2),o.astral?(i=v(t,r,o),s=Array.from(t).length+Array.from(r).length):o.wildcards?(i=k(t,r,o,b),s=t.length+r.length):(i=b(t,r,o),s=t.length+r.length),Math.round((s-i)/s*100)}function _partial_ratio(t,r,o){if(!z(t))return 0;if(!z(r))return 0;if(t.length<=r.length)var n=t,i=r;else n=r,i=t;for(var s=new e(null,n,i).getMatchingBlocks(),a=[],c=0;c<s.length;c++){var l=s[c][1]-s[c][0]>0?s[c][1]-s[c][0]:0,u=l+n.length,f=_ratio(n,i.substring(l,u),o);if(f>99.5)return 100;a.push(f)}return Math.max.apply(null,a)}Object.keys||(Object.keys=(I=Object.prototype.hasOwnProperty,q=!{toString:null}.propertyIsEnumerable("toString"),E=(A=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var t,r,o=[];for(t in e)I.call(e,t)&&o.push(t);if(q)for(r=0;r<E;r++)I.call(e,A[r])&&o.push(A[r]);return o}));var R=void 0;"undefined"!=typeof Promise&&(R=function(e,t,r){return new Promise((function(o,n){extractAsync(e,t,r,(function(e,t){e?n(e):o(t)}))}))});var P={distance:function distance(e,t,r){var o=x(r);return e=o.normalize?e.normalize():e,t=o.normalize?t.normalize():t,e=o.full_process?j(e,o):e,t=o.full_process?j(t,o):t,void 0===o.subcost&&(o.subcost=1),o.astral?v(e,t,o):k(e,t,o,b)},ratio:QRatio,partial_ratio:function partial_ratio(e,t,r){var o=x(r);return e=o.normalize?e.normalize():e,t=o.normalize?t.normalize():t,e=o.full_process?j(e,o):e,t=o.full_process?j(t,o):t,z(e)&&z(t)?_partial_ratio(e,t,o):0},token_set_ratio:token_set_ratio,token_sort_ratio:token_sort_ratio,partial_token_set_ratio:partial_token_set_ratio,partial_token_sort_ratio:partial_token_sort_ratio,token_similarity_sort_ratio:function token_similarity_sort_ratio(e,t,r){var o=x(r);return e=o.normalize?e.normalize():e,t=o.normalize?t.normalize():t,e=o.full_process?j(e,o):e,t=o.full_process?j(t,o):t,z(e)&&z(t)?_token_similarity_sort_ratio(e,t,o):0},partial_token_similarity_sort_ratio:function partial_token_similarity_sort_ratio(e,t,r){var o=x(r);return e=o.normalize?e.normalize():e,t=o.normalize?t.normalize():t,e=o.full_process?j(e,o):e,t=o.full_process?j(t,o):t,z(e)&&z(t)?(o.partial=!0,_token_similarity_sort_ratio(e,t,o)):0},WRatio:function WRatio(e,t,r){var o=x(r);if(e=o.normalize?e.normalize():e,t=o.normalize?t.normalize():t,e=o.full_process?j(e,o):e,t=o.full_process?j(t,o):t,o.full_process=!1,!z(e))return 0;if(!z(t))return 0;var n=!0,i=.95,s=.9,a=_ratio(e,t,o),c=Math.max(e.length,t.length)/Math.min(e.length,t.length);if(c<1.5&&(n=!1),c>8&&(s=.6),n){var l=_partial_ratio(e,t,o)*s,u=partial_token_sort_ratio(e,t,o)*i*s,f=partial_token_set_ratio(e,t,o)*i*s;return Math.round(Math.max(a,l,u,f))}var p=token_sort_ratio(e,t,o)*i,h=token_set_ratio(e,t,o)*i;return Math.round(Math.max(a,p,h))},full_process:j,extract:extract,extractAsync:extractAsync,extractAsPromised:R,process_and_sort:C,unique_tokens:S,dedupe:O};t.exports=P}(),t.exports}));
